{% extends "_base.html" %}
{% block title %}{{ page.title }}{% endblock %}

{% block content %}
<h1>{{ page.title }}</h1>

{% if page.team %}
  <p style="color:#94a3b8;font-size:.9rem;">
    Team: <strong>{{ page.team.name }}</strong>
    {% if page.visibility == "team" %}
      路 <span>Team-only</span>
    {% else %}
      路 <span>Published to class</span>
    {% endif %}
  </p>
{% else %}
  <p style="color:#94a3b8;font-size:.9rem;">
    Global doc
    {% if page.visibility == "class" %}
      路 Published to class
    {% endif %}
  </p>
{% endif %}

<p style="color:#64748b;font-size:.9rem;">
  {% if page.category %}Category: {{ page.category.name }} 路 {% endif %}
  Last updated {{ page.updated_at|date:"Y-m-d H:i" }}
  {% if page.author %} 路 by {{ page.author.username }}{% endif %}
</p>

<div class="markdown-body">
  {{ html|safe }}
</div>

{# ACTIONS #}
<div style="margin-top:1.25rem; display:flex; gap:.75rem; flex-wrap:wrap;">

  {# 1) Staff: can always edit + can publish when team-only #}
  {% if user.is_staff %}
    <a href="{% url 'docs:edit' page.slug %}" class="btn">
      锔 Edit
    </a>

    {% if page.visibility == "team" %}
      <form action="{% url 'docs:publish' page.slug %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn">
           Publish to class
        </button>
      </form>
    {% endif %}

  {% else %}
    {# 2) Team members: can always edit their teams page, even after publish #}
    {% if user.is_authenticated and user.profile.team and page.team == user.profile.team %}
      <a href="{% url 'docs:edit' page.slug %}" class="btn">
        锔 Edit
      </a>

      {# Optional: only staff can publish; team just sees a note when already published #}
      {% if page.visibility == "class" %}
        <span style="font-size:.9rem;color:#94a3b8;">
          Visible to the whole class. Instructors can adjust visibility if needed.
        </span>
      {% endif %}
    {% endif %}
  {% endif %}
</div>

{% endblock %}
