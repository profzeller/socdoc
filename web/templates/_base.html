<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}SOC Docs{% endblock %}</title>
  <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">
    <a href="/" class="brand">SOC Docs</a>
    <a href="/docs/">Docs</a>
    <!-- # Temporarily hiding Policies & Diagrams for v1
    <a href="/policies/">Policies</a>
    <a href="/diagrams/">Diagrams</a>
    -->
    {% if user.is_staff %}
      <a href="/moderation/">Moderation</a>
      <a href="/grading/">Grading</a>
    {% endif %}
  </div>

    <div class="nav-right">
  <button id="theme-toggle" class="theme-toggle" title="Toggle dark mode">ðŸŒ“</button>

  {% if user.is_authenticated %}
    {% if user.profile and user.profile.team %}
      <span class="team-pill">{{ user.profile.team.name }}</span>
    {% elif CURRENT_TEAM %}
      <span class="team-pill">{{ CURRENT_TEAM.name }}</span>
    {% endif %}

    <!-- User identity: avatar + username -->
    <a href="{% url 'accounts:profile' %}" class="user-link" title="Profile / Teams">
      {% with sa=user.socialaccount_set.first %}
        {% if sa %}
          <img class="avatar" src="{{ sa.get_avatar_url }}" alt="avatar">
        {% else %}
          <span class="avatar avatar-fallback">
            {{ user.get_username|first|upper }}
          </span>
        {% endif %}
      {% endwith %}
      <span class="username">{{ user.get_username }}</span>
    </a>

    <form method="post" action="{% url 'account_logout' %}" class="logout-form">
      {% csrf_token %}
      <button type="submit" class="logout-btn">Logout</button>
    </form>
  {% else %}
    <a href="{% url 'account_login' %}">Login</a>
  {% endif %}
</div>

  </nav>

  <main class="page-content">
      {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li class="message {{ message.tags }}">{{ message }}</li>
            {% endfor %}
        </ul>
      {% endif %}
    {% block content %}{% endblock %}
  </main>

  <script>
    // Theme persistence + toggle logic
    const toggle = document.getElementById('theme-toggle');
    const body = document.body;
    const saved = localStorage.getItem('theme');
    if (saved) {
      body.className = saved;
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      body.className = 'dark';
    }
    toggle.addEventListener('click', () => {
      const newTheme = body.classList.contains('dark') ? 'light' : 'dark';
      body.className = newTheme;
      localStorage.setItem('theme', newTheme);
    });
  </script>
</body>
</html>
